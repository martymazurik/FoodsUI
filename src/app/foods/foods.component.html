<div class="foods-container">
  <mat-form-field appearance="fill" class="search-field">
    <mat-label>Search Foods</mat-label>
    <input matInput 
           [formControl]="searchControl" 
           (keyup.enter)="performSearch()"
           placeholder="Enter food name and press Enter...">
    <mat-spinner *ngIf="isLoading" 
                 matSuffix 
                 diameter="20">
    </mat-spinner>
  </mat-form-field>

  <!-- Single food result - no ngFor needed -->
  <mat-accordion *ngIf="currentFood">
    <mat-expansion-panel [expanded]="true"
                        class="food-panel">
      <mat-expansion-panel-header>
        <mat-panel-title>
          {{currentFood.description}}
        </mat-panel-title>
      </mat-expansion-panel-header>

      <div class="panel-content">
        <div class="nutrition-section">
          <div class="main-nutrients">
            <div class="header-actions">
              <button mat-button 
                      class="all-nutrients-btn"
                      (click)="showAllNutrients()">
                  <span fxHide.lt-md>{{showingAllNutrients ? 'Shrink ^' : 'Show All Nutrients'}}</span>
                  <span fxShow.lt-md>{{showingAllNutrients ? 'Shrink ^' : 'Show all'}}</span>
              </button>
            </div>

            <!-- Responsive table wrapper -->
            <div class="table-responsive">
              <table mat-table [dataSource]="getNutrients(currentFood)" class="nutrient-table">
                <ng-container matColumnDef="label">
                  <th mat-header-cell *matHeaderCellDef> Nutrient </th>
                  <td mat-cell *matCellDef="let nutrient"> {{nutrient.label}} </td>
                </ng-container>

                <ng-container matColumnDef="value">
                  <th mat-header-cell *matHeaderCellDef> Value </th>
                  <td mat-cell *matCellDef="let nutrient"> {{nutrient.value}} </td>
                </ng-container>

                <ng-container matColumnDef="unit">
                  <th mat-header-cell *matHeaderCellDef> Unit </th>
                  <td mat-cell *matCellDef="let nutrient"> {{nutrient.unit}} </td>
                </ng-container>

                <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
                <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
              </table>
            </div>

            <div class="footer-label">
              <mat-label class="per-100g-label">
                per 100g
              </mat-label>
            </div>
          </div>

          <!-- Mobile-optimized all nutrients view -->
          <div class="all-nutrients" 
               *ngIf="showingAllNutrients">
            <mat-list *ngIf="currentFood.nutritionFacts">
              <mat-list-item>
                <div class="nutrient-row">
                  <div class="nutrient-name">Food Name</div>
                  <div class="nutrient-value-container">
                    <span class="value">{{currentFood.nutritionFacts.foodName}}</span>
                  </div>
                </div>
              </mat-list-item>
              <mat-list-item>
                <div class="nutrient-row">
                  <div class="nutrient-name">Serving Size</div>
                  <div class="nutrient-value-container">
                    <span class="value">{{currentFood.nutritionFacts.servingSizeHousehold}}</span>
                  </div>
                </div>
              </mat-list-item>
              <mat-list-item>
                <div class="nutrient-row">
                  <div class="nutrient-name">Serving Size (g)</div>
                  <div class="nutrient-value-container">
                    <span class="value">{{currentFood.nutritionFacts.servingSizeG}}</span>
                    <span class="unit">g</span>
                  </div>
                </div>
              </mat-list-item>
              <mat-list-item>
                <div class="nutrient-row">
                  <div class="nutrient-name">Servings Per Container</div>
                  <div class="nutrient-value-container">
                    <span class="value">{{currentFood.nutritionFacts.servingsPerContainer}}</span>
                  </div>
                </div>
              </mat-list-item>
              <mat-list-item>
                <div class="nutrient-row">
                  <div class="nutrient-name">Calories</div>
                  <div class="nutrient-value-container">
                    <span class="value">{{currentFood.nutritionFacts.calories}}</span>
                    <span class="unit">kcal</span>
                  </div>
                </div>
              </mat-list-item>
              <mat-list-item>
                <div class="nutrient-row">
                  <div class="nutrient-name">Total Fat</div>
                  <div class="nutrient-value-container">
                    <span class="value">{{currentFood.nutritionFacts.totalFatG}}</span>
                    <span class="unit">g</span>
                  </div>
                </div>
              </mat-list-item>
              <mat-list-item>
                <div class="nutrient-row">
                  <div class="nutrient-name">Saturated Fat</div>
                  <div class="nutrient-value-container">
                    <span class="value">{{currentFood.nutritionFacts.saturatedFatG}}</span>
                    <span class="unit">g</span>
                  </div>
                </div>
              </mat-list-item>
              <mat-list-item>
                <div class="nutrient-row">
                  <div class="nutrient-name">Trans Fat</div>
                  <div class="nutrient-value-container">
                    <span class="value">{{currentFood.nutritionFacts.transFatG}}</span>
                    <span class="unit">g</span>
                  </div>
                </div>
              </mat-list-item>
              <mat-list-item>
                <div class="nutrient-row">
                  <div class="nutrient-name">Cholesterol</div>
                  <div class="nutrient-value-container">
                    <span class="value">{{currentFood.nutritionFacts.cholesterolMG}}</span>
                    <span class="unit">mg</span>
                  </div>
                </div>
              </mat-list-item>
              <mat-list-item>
                <div class="nutrient-row">
                  <div class="nutrient-name">Sodium</div>
                  <div class="nutrient-value-container">
                    <span class="value">{{currentFood.nutritionFacts.sodiumMG}}</span>
                    <span class="unit">mg</span>
                  </div>
                </div>
              </mat-list-item>
              <mat-list-item>
                <div class="nutrient-row">
                  <div class="nutrient-name">Total Carbohydrate</div>
                  <div class="nutrient-value-container">
                    <span class="value">{{currentFood.nutritionFacts.totalCarbohydrateG}}</span>
                    <span class="unit">g</span>
                  </div>
                </div>
              </mat-list-item>
              <mat-list-item>
                <div class="nutrient-row">
                  <div class="nutrient-name">Dietary Fiber</div>
                  <div class="nutrient-value-container">
                    <span class="value">{{currentFood.nutritionFacts.dietaryFiberG}}</span>
                    <span class="unit">g</span>
                  </div>
                </div>
              </mat-list-item>
              <mat-list-item>
                <div class="nutrient-row">
                  <div class="nutrient-name">Total Sugars</div>
                  <div class="nutrient-value-container">
                    <span class="value">{{currentFood.nutritionFacts.totalSugarsG}}</span>
                    <span class="unit">g</span>
                  </div>
                </div>
              </mat-list-item>
              <mat-list-item>
                <div class="nutrient-row">
                  <div class="nutrient-name">Added Sugars</div>
                  <div class="nutrient-value-container">
                    <span class="value">{{currentFood.nutritionFacts.addedSugarsG}}</span>
                    <span class="unit">g</span>
                  </div>
                </div>
              </mat-list-item>
              <mat-list-item>
                <div class="nutrient-row">
                  <div class="nutrient-name">Protein</div>
                  <div class="nutrient-value-container">
                    <span class="value">{{currentFood.nutritionFacts.proteinG}}</span>
                    <span class="unit">g</span>
                  </div>
                </div>
              </mat-list-item>
              <mat-list-item>
                <div class="nutrient-row">
                  <div class="nutrient-name">Vitamin D</div>
                  <div class="nutrient-value-container">
                    <span class="value">{{currentFood.nutritionFacts.vitaminDMcg}}</span>
                    <span class="unit">mcg</span>
                  </div>
                </div>
              </mat-list-item>
              <mat-list-item>
                <div class="nutrient-row">
                  <div class="nutrient-name">Calcium</div>
                  <div class="nutrient-value-container">
                    <span class="value">{{currentFood.nutritionFacts.calciumMG}}</span>
                    <span class="unit">mg</span>
                  </div>
                </div>
              </mat-list-item>
              <mat-list-item>
                <div class="nutrient-row">
                  <div class="nutrient-name">Iron</div>
                  <div class="nutrient-value-container">
                    <span class="value">{{currentFood.nutritionFacts.ironMG}}</span>
                    <span class="unit">mg</span>
                  </div>
                </div>
              </mat-list-item>
              <mat-list-item>
                <div class="nutrient-row">
                  <div class="nutrient-name">Potassium</div>
                  <div class="nutrient-value-container">
                    <span class="value">{{currentFood.nutritionFacts.potassiumMG}}</span>
                    <span class="unit">mg</span>
                  </div>
                </div>
              </mat-list-item>
            </mat-list>
          </div>
        </div>

        <!-- URI List Component - Now at the bottom, full width -->
        <app-uri-list 
          *ngIf="hasBrandInfo(currentFood)"
          [nutritionSiteCandidates]="currentFood.brandInfo?.nutritionSiteCandidates || []"
          [productImageSiteCandidates]="currentFood.brandInfo?.productImageSiteCandidates || []">
        </app-uri-list>
      </div>
    </mat-expansion-panel>
  </mat-accordion>
</div>