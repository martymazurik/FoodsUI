<div class="foods-container">
  <!-- Search box stays full-width at top -->
  <mat-form-field appearance="fill" class="search-field">
    <mat-label>Search Foods</mat-label>
    <input matInput 
           [formControl]="searchControl" 
           (keyup.enter)="performSearch()"
           placeholder="Enter food name and press Enter...">
    <mat-spinner *ngIf="isLoading" 
                 matSuffix 
                 diameter="20">
    </mat-spinner>
  </mat-form-field>

  <!-- NEW: Split layout with results list on left, details on right -->
  <div class="results-layout" *ngIf="foods.length > 0">
    
    <!-- Left sidebar: Results list -->
    <div class="results-sidebar">
      <mat-selection-list [multiple]="false" 
                          (selectionChange)="onFoodSelected($event.options[0].value)">
        <mat-list-option *ngFor="let food of foods; let i = index" 
                         [value]="i"
                         [selected]="i === selectedIndex"
                         [matTooltip]="food?.description || ''"
                         matTooltipPosition="right">
          {{ truncateDescription(food?.description) }}
        </mat-list-option>
      </mat-selection-list>
    </div>

    <!-- Right side: Selected food details -->
    <div class="details-panel">
      <div class="food-details" *ngIf="selectedFood">
        <h2 class="food-title">{{selectedFood.description}}</h2>

        <div class="panel-content">
          <div class="nutrition-section">
            <div class="main-nutrients">
              <div class="header-actions">
                <button mat-button 
                        class="all-nutrients-btn"
                        (click)="showAllNutrients()">
                  {{showingAllNutrients ? 'Hide Nutrients' : 'Show All Nutrients'}}
                </button>
              </div>

                <!-- Responsive table wrapper -->
                <div class="table-responsive">
                  <table mat-table [dataSource]="getNutrients(selectedFood)" class="nutrient-table">
                    <ng-container matColumnDef="label">
                      <th mat-header-cell *matHeaderCellDef> Nutrient </th>
                      <td mat-cell *matCellDef="let nutrient"> {{nutrient.label}} </td>
                    </ng-container>

                    <ng-container matColumnDef="value">
                      <th mat-header-cell *matHeaderCellDef> Value </th>
                      <td mat-cell *matCellDef="let nutrient"> {{nutrient.value}} </td>
                    </ng-container>

                    <ng-container matColumnDef="unit">
                      <th mat-header-cell *matHeaderCellDef> Unit </th>
                      <td mat-cell *matCellDef="let nutrient"> {{nutrient.unit}} </td>
                    </ng-container>

                    <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
                    <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
                  </table>
                </div>

                <div class="footer-label">
                  <mat-label class="per-100g-label">
                    per 100g
                  </mat-label>
                </div>
              </div>

              <!-- Mobile-optimized all nutrients view -->
              <div class="all-nutrients" 
                   *ngIf="showingAllNutrients">
                <mat-list *ngIf="selectedFood.nutritionFacts">
                  <mat-list-item>
                    <div class="nutrient-row">
                      <div class="nutrient-name">Food Name</div>
                      <div class="nutrient-value-container">
                        <span class="value">{{selectedFood.nutritionFacts.foodName}}</span>
                      </div>
                    </div>
                  </mat-list-item>
                  <mat-list-item>
                    <div class="nutrient-row">
                      <div class="nutrient-name">Serving Size</div>
                      <div class="nutrient-value-container">
                        <span class="value">{{selectedFood.nutritionFacts.servingSizeHousehold}}</span>
                      </div>
                    </div>
                  </mat-list-item>
                  <mat-list-item>
                    <div class="nutrient-row">
                      <div class="nutrient-name">Serving Size (g)</div>
                      <div class="nutrient-value-container">
                        <span class="value">{{selectedFood.nutritionFacts.servingSizeG}}</span>
                        <span class="unit">g</span>
                      </div>
                    </div>
                  </mat-list-item>
                  <mat-list-item>
                    <div class="nutrient-row">
                      <div class="nutrient-name">Servings Per Container</div>
                      <div class="nutrient-value-container">
                        <span class="value">{{selectedFood.nutritionFacts.servingsPerContainer}}</span>
                      </div>
                    </div>
                  </mat-list-item>
                  <mat-list-item>
                    <div class="nutrient-row">
                      <div class="nutrient-name">Calories</div>
                      <div class="nutrient-value-container">
                        <span class="value">{{selectedFood.nutritionFacts.calories}}</span>
                        <span class="unit">kcal</span>
                      </div>
                    </div>
                  </mat-list-item>
                  <mat-list-item>
                    <div class="nutrient-row">
                      <div class="nutrient-name">Total Fat</div>
                      <div class="nutrient-value-container">
                        <span class="value">{{selectedFood.nutritionFacts.totalFatG}}</span>
                        <span class="unit">g</span>
                      </div>
                    </div>
                  </mat-list-item>
                  <mat-list-item>
                    <div class="nutrient-row">
                      <div class="nutrient-name">Saturated Fat</div>
                      <div class="nutrient-value-container">
                        <span class="value">{{selectedFood.nutritionFacts.saturatedFatG}}</span>
                        <span class="unit">g</span>
                      </div>
                    </div>
                  </mat-list-item>
                  <mat-list-item>
                    <div class="nutrient-row">
                      <div class="nutrient-name">Trans Fat</div>
                      <div class="nutrient-value-container">
                        <span class="value">{{selectedFood.nutritionFacts.transFatG}}</span>
                        <span class="unit">g</span>
                      </div>
                    </div>
                  </mat-list-item>
                  <mat-list-item>
                    <div class="nutrient-row">
                      <div class="nutrient-name">Cholesterol</div>
                      <div class="nutrient-value-container">
                        <span class="value">{{selectedFood.nutritionFacts.cholesterolMG}}</span>
                        <span class="unit">mg</span>
                      </div>
                    </div>
                  </mat-list-item>
                  <mat-list-item>
                    <div class="nutrient-row">
                      <div class="nutrient-name">Sodium</div>
                      <div class="nutrient-value-container">
                        <span class="value">{{selectedFood.nutritionFacts.sodiumMG}}</span>
                        <span class="unit">mg</span>
                      </div>
                    </div>
                  </mat-list-item>
                  <mat-list-item>
                    <div class="nutrient-row">
                      <div class="nutrient-name">Total Carbohydrate</div>
                      <div class="nutrient-value-container">
                        <span class="value">{{selectedFood.nutritionFacts.totalCarbohydrateG}}</span>
                        <span class="unit">g</span>
                      </div>
                    </div>
                  </mat-list-item>
                  <mat-list-item>
                    <div class="nutrient-row">
                      <div class="nutrient-name">Dietary Fiber</div>
                      <div class="nutrient-value-container">
                        <span class="value">{{selectedFood.nutritionFacts.dietaryFiberG}}</span>
                        <span class="unit">g</span>
                      </div>
                    </div>
                  </mat-list-item>
                  <mat-list-item>
                    <div class="nutrient-row">
                      <div class="nutrient-name">Total Sugars</div>
                      <div class="nutrient-value-container">
                        <span class="value">{{selectedFood.nutritionFacts.totalSugarsG}}</span>
                        <span class="unit">g</span>
                      </div>
                    </div>
                  </mat-list-item>
                  <mat-list-item>
                    <div class="nutrient-row">
                      <div class="nutrient-name">Added Sugars</div>
                      <div class="nutrient-value-container">
                        <span class="value">{{selectedFood.nutritionFacts.addedSugarsG}}</span>
                        <span class="unit">g</span>
                      </div>
                    </div>
                  </mat-list-item>
                  <mat-list-item>
                    <div class="nutrient-row">
                      <div class="nutrient-name">Protein</div>
                      <div class="nutrient-value-container">
                        <span class="value">{{selectedFood.nutritionFacts.proteinG}}</span>
                        <span class="unit">g</span>
                      </div>
                    </div>
                  </mat-list-item>
                  <mat-list-item>
                    <div class="nutrient-row">
                      <div class="nutrient-name">Vitamin D</div>
                      <div class="nutrient-value-container">
                        <span class="value">{{selectedFood.nutritionFacts.vitaminDMcg}}</span>
                        <span class="unit">mcg</span>
                      </div>
                    </div>
                  </mat-list-item>
                  <mat-list-item>
                    <div class="nutrient-row">
                      <div class="nutrient-name">Calcium</div>
                      <div class="nutrient-value-container">
                        <span class="value">{{selectedFood.nutritionFacts.calciumMG}}</span>
                        <span class="unit">mg</span>
                      </div>
                    </div>
                  </mat-list-item>
                  <mat-list-item>
                    <div class="nutrient-row">
                      <div class="nutrient-name">Iron</div>
                      <div class="nutrient-value-container">
                        <span class="value">{{selectedFood.nutritionFacts.ironMG}}</span>
                        <span class="unit">mg</span>
                      </div>
                    </div>
                  </mat-list-item>
                  <mat-list-item>
                    <div class="nutrient-row">
                      <div class="nutrient-name">Potassium</div>
                      <div class="nutrient-value-container">
                        <span class="value">{{selectedFood.nutritionFacts.potassiumMG}}</span>
                        <span class="unit">mg</span>
                      </div>
                    </div>
                  </mat-list-item>
                </mat-list>
              </div>
            </div>
          </div>

          <!-- Image Display Section -->
          <div class="image-display-section" *ngIf="selectedFood && hasAnyImages()">
            <h3 class="section-title">Current Images</h3>
            <div class="images-container">
              <div class="image-card" *ngIf="hasNutritionImage()">
                <div class="image-header">
                  <span class="image-label">Nutrition Facts Label</span>
                  <span class="image-status" 
                        [class.status-completed]="nutritionFactsStatus === 'completed'"
                        [class.status-processing]="nutritionFactsStatus === 'processing'"
                        [class.status-pending]="nutritionFactsStatus === 'pending'">
                    {{nutritionFactsStatus || 'uploaded'}}
                  </span>
                </div>
                <div class="image-wrapper">
                  <img [src]="nutritionImageUrl()" 
                       alt="Nutrition Facts Label"
                       class="food-image nutrition-image"
                       loading="lazy">
                </div>
              </div>

              <div class="image-card" *ngIf="hasProductImage()">
                <div class="image-header">
                  <span class="image-label">Product Photo</span>
                </div>
                <div class="image-wrapper">
                  <img [src]="productImageUrl()" 
                       alt="Product Photo"
                       class="food-image product-image"
                       loading="lazy">
                </div>
              </div>
            </div>
          </div>

          <!-- URI List Component -->
          <app-uri-list 
            *ngIf="hasBrandInfo(selectedFood)"
            [nutritionSiteCandidates]="selectedFood.brandInfo?.nutritionSiteCandidates || []"
            [productImageSiteCandidates]="selectedFood.brandInfo?.productImageSiteCandidates || []">
          </app-uri-list>

          <!-- Image Upload Component -->
          <app-image-upload 
            [foodQuery]="currentFoodQuery"
            [existingNutritionImageId]="existingNutritionImageId"
            [existingProductImageId]="existingProductImageId"
            [nutritionFactsStatus]="nutritionFactsStatus"
            (imagesUploaded)="onImagesUploaded($event)"
            (refreshFood)="onRefreshFood()">
          </app-image-upload>
        </div>
      </div>
    </div>
  </div>
</div>